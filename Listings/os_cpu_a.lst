


ARM Macro Assembler    Page 1 


    1 00000000                 EXPORT           mySystemInit
    2 00000000                 EXPORT           OSCtxSw
    3 00000000                 EXPORT           OSIntCtxSw
    4 00000000                 EXPORT           PendSV_Handler
    5 00000000                 EXPORT           OSStartHighRdy
    6 00000000                 EXPORT           OS_CPU_SR_Save
    7 00000000                 EXPORT           OS_CPU_SR_Restore
    8 00000000         
    9 00000000                 EXTERN           OSTCBCur
   10 00000000                 EXTERN           OSTCBHighRdy
   11 00000000                 EXTERN           OSPrioCur
   12 00000000                 EXTERN           OSPrioHighRdy
   13 00000000                 EXTERN           OSRunning
   14 00000000         
   15 00000000         
   16 00000000                 AREA             |.text|,CODE,READONLY
   17 00000000         OS_CPU_SR_Save
   18 00000000 B672            CPSID            I
   19 00000002 B402            PUSH             {R1}        ; ‰øùÂ≠ò R1ÔºàÂêéÈù
                                                            ¢‰ΩøÁî®Âà∞Ôºâ
   20 00000004 F3EF 8111       MRS              R1, BASEPRI ; ‰øùÂ≠òÂΩìÂâçÁöÑ B
                                                            ASEPRIÔºà‰∏≠Êñ≠Â±èË
                                                            îΩ‰ºòÂÖàÁ∫ßÔºâ
   21 00000008 F380 8811       MSR              BASEPRI, R0 ; ËÆæÁΩÆÊñ∞ÁöÑ BASE
                                                            PRI ‚Äî‚Äî ÂèÇÊï∞ R
                                                            0 ÊòØÊñ∞ÁöÑÂ±èËîΩÁ∫
                                                            ßÂà´ÔºàÊõ¥È´òÁöÑ‰ºò
                                                            ÂÖàÁ∫ßÔºâ
   22 0000000C F3BF 8F4F       DSB                          ; Êï∞ÊçÆÂêåÊ≠•Â±èÈö
                                                            úÔºåÁ°Æ‰øùÊåá‰ª§È°∫
                                                            Â∫èÂíåÂÜÖÂ≠òËÆøÈóÆÈ
                                                            °∫Â∫è
   23 00000010 F3BF 8F6F       ISB                          ; Êåá‰ª§ÂêåÊ≠•Â±èÈö
                                                            úÔºåÂà∑Êñ∞ÊµÅÊ∞¥Á∫ø
                                                            ÔºåÁ°Æ‰øùÂêéÁª≠ÊâßË
                                                            °åÁöÑÊòØÊñ∞Áä∂ÊÄÅ
   24 00000014 4608            MOV              R0, R1      ; ËøîÂõûÊóßÁöÑ BASE
                                                            PRIÔºà‰∏¥ÁïåÂå∫ÂâçÁ
                                                            öÑ‰∏≠Êñ≠Áä∂ÊÄÅÔºâ
   25 00000016 BC02            POP              {R1}        ; ÊÅ¢Â§ç R1
   26 00000018 B662            CPSIE            I
   27 0000001A 4770            BX               LR
   28 0000001C         
   29 0000001C         
   30 0000001C         OS_CPU_SR_Restore
   31 0000001C B672            CPSID            I
   32 0000001E F380 8811       MSR              BASEPRI, R0 ; ÊÅ¢Â§çÊóßÁöÑ BASE
                                                            PRI ÂÄº
   33 00000022 F3BF 8F4F       DSB
   34 00000026 F3BF 8F6F       ISB
   35 0000002A B662            CPSIE            I
   36 0000002C 4770            BX               LR
   37 0000002E         
   38 0000002E         
   39 0000002E E000ED20 
                       SCB_SHPR3
                               EQU              0XE000ED20
   40 0000002E         OSStartHighRdy
   41 0000002E B672            CPSID            I



ARM Macro Assembler    Page 2 


   42 00000030         ; OSTCBCur=OSTCBHighRdy
   43 00000030 484D            LDR              R0,=OSTCBCur
   44 00000032 494E            LDR              R1,=OSTCBHighRdy
   45 00000034 680A            LDR              R2,[R1]
   46 00000036 6002            STR              R2,[R0]
   47 00000038         ;OSPrioCur=OSPrioHighRdy
   48 00000038 484D            LDR              R0,=OSPrioCur
   49 0000003A 494E            LDR              R1,=OSPrioHighRdy
   50 0000003C 780A            LDRB             R2,[R1]     ;INT8UÁ±ªÂûã
   51 0000003E 7002            STRB             R2,[R0]
   52 00000040         
   53 00000040         ;PENDSV PRIO(Pri14)
   54 00000040 484D            LDR              R0,=SCB_SHPR3
   55 00000042 F8D0 1002       LDR              R1,[R0,#2]
   56 00000046 F041 01FF       ORR              R1,R1,#0XFF
   57 0000004A 7081            STRB             R1,[R0,#2]
   58 0000004C         
   59 0000004C         ;OSRUNNING
   60 0000004C 484B            LDR              R0,=OSRunning
   61 0000004E F04F 0101       MOV              R1,#1
   62 00000052 7001            STRB             R1,[R0]
   63 00000054         
   64 00000054         ;PSP init
   65 00000054 2000            MOVS             R0,#0
   66 00000056 F380 8809       MSR              PSP,R0
   67 0000005A         
   68 0000005A 4843            LDR              R0,=OSTCBCur
   69 0000005C 6801            LDR              R1,[R0]
   70 0000005E 680A            LDR              R2,[R1]
   71 00000060 F382 8809       MSR              PSP,R2
   72 00000064         ;use PSP
   73 00000064 F3EF 8114       MRS              R1,CONTROL
   74 00000068 F041 0102       ORR              R1,R1,#2
   75 0000006C F381 8814       MSR              CONTROL, R1
   76 00000070 F3BF 8F6F       ISB
   77 00000074         
   78 00000074         ;TASK1 
   79 00000074 E8BD 4FF0       LDMFD            SP!,{R4-R11,LR}
   80 00000078 E8BD 500F       LDMFD            SP!,{R0-R3,R12,LR}
   81 0000007C         ; LDMFD SP!,{R0-R3}
   82 0000007C         ; LDMFD SP!,{R12,LR}
   83 0000007C BC06            LDMFD            SP!,{R1,R2}
   84 0000007E F382 8803       MSR              XPSR,R2
   85 00000082 B662            CPSIE            I
   86 00000084 4708            BX               R1
   87 00000086         
   88 00000086         
   89 00000086         
   90 00000086 E000ED04 
                       SCB_ICSR
                               EQU              0XE000ED04
   91 00000086         
   92 00000086         OSCtxSw
   93 00000086         ;pendsvset
   94 00000086 483E            LDR              R0,=SCB_ICSR
   95 00000088 6801            LDR              R1,[R0]
   96 0000008A F041 5180       ORR              R1,R1,#(1<<28)
   97 0000008E 6001            STR              R1,[R0]
   98 00000090 4770            BX               LR



ARM Macro Assembler    Page 3 


   99 00000092         
  100 00000092         OSIntCtxSw
  101 00000092 483B            LDR              R0,=SCB_ICSR
  102 00000094 6801            LDR              R1,[R0]
  103 00000096 F041 5180       ORR              R1,R1,#(1<<28)
  104 0000009A 6001            STR              R1,[R0]
  105 0000009C 4770            BX               LR
  106 0000009E         
  107 0000009E         PendSV_Handler
  108 0000009E         ;SAVE R4-R11,LR
  109 0000009E F3EF 8009       MRS              R0,psp
  110 000000A2 E920 4FF0       STMFD            R0!,{R4-R11,LR}
  111 000000A6         ;SAVE SP
  112 000000A6 4930            LDR              R1,=OSTCBCur
  113 000000A8 680A            LDR              R2,[R1]
  114 000000AA 6010            STR              R0,[R2]
  115 000000AC         ;UPDATE OSTCBCur
  116 000000AC 482E            LDR              R0,=OSTCBCur
  117 000000AE 492F            LDR              R1,=OSTCBHighRdy
  118 000000B0 680A            LDR              R2,[R1]
  119 000000B2 6002            STR              R2,[R0]
  120 000000B4         ;UPDATE OSPrioCur
  121 000000B4 482E            LDR              R0,=OSPrioCur
  122 000000B6 492F            LDR              R1,=OSPrioHighRdy
  123 000000B8 780A            LDRB             R2,[R1]
  124 000000BA 7002            STRB             R2,[R0]
  125 000000BC         ;NEW R4-R11,LR
  126 000000BC 492A            LDR              R1,=OSTCBCur
  127 000000BE 680A            LDR              R2,[R1]
  128 000000C0 6812            LDR              R2,[R2]
  129 000000C2 E8B2 4FF0       LDMFD            R2!,{R4-R11,LR}
  130 000000C6 F382 8809       MSR              psp,R2
  131 000000CA 4770            BX               LR
  132 000000CC         
  133 000000CC         ; Exception return will restore remaining context
  134 000000CC         
  135 000000CC 40023800 
                       RCC_BASE
                               EQU              0x40023800
  136 000000CC 40023C00 
                       FLASH_BASE
                               EQU              0x40023C00
  137 000000CC 40023800 
                       RCC_CR  EQU              RCC_BASE+0x00
  138 000000CC 40023804 
                       RCC_PLLCFGR
                               EQU              RCC_BASE+0x04
  139 000000CC 40023808 
                       RCC_CFGR
                               EQU              RCC_BASE+0x08
  140 000000CC 40023C00 
                       FLASH_ACR
                               EQU              FLASH_BASE + 0x00
  141 000000CC E000E010 
                       STK_BASE
                               EQU              0XE000E010
  142 000000CC E000E010 
                       STK_CTRL
                               EQU              STK_BASE+0X00



ARM Macro Assembler    Page 4 


  143 000000CC E000E014 
                       STK_LOAD
                               EQU              STK_BASE+0X04
  144 000000CC E000E018 
                       STK_VAL EQU              STK_BASE+0X08
  145 000000CC E000E01C 
                       STK_CALIB
                               EQU              STK_BASE+0X0C
  146 000000CC         
  147 000000CC         
  148 000000CC         mySystemInit
  149 000000CC         ;HSEON
  150 000000CC 482D            LDR              R0,=RCC_CR
  151 000000CE 6801            LDR              R1,[R0]
  152 000000D0 F441 3180       ORR              R1,R1,#(1<<16)
  153 000000D4 F441 2180       ORR              R1,R1,#(1<<18) 
                                                            ;ÊâìÂºÄ‰∫ÜHSEÊóÅË∑Ø
                                                            
  154 000000D8 6001            STR              R1,[R0]
  155 000000DA         
  156 000000DA         ;HSERDY
  157 000000DA         hse_wait
  158 000000DA 6801            LDR              R1,[R0]
  159 000000DC F411 3F00       TST              R1,#(1<<17)
  160 000000E0 D0FB            BEQ              hse_wait
  161 000000E2         
  162 000000E2         ;FLASH
  163 000000E2 4829            LDR              R0, =FLASH_ACR
  164 000000E4 F04F 0102       MOV              R1, #0x02
  165 000000E8 6001            STR              R1, [R0]
  166 000000EA         
  167 000000EA         ;PLLM=16,PLLN=336,PLLP=4
  168 000000EA 4828            LDR              R0,=RCC_PLLCFGR
  169 000000EC F04F 0100       MOV              R1,#0X00000000
  170 000000F0 F041 0108       ORR              R1, R1, #8  ; PLLM = 8
  171 000000F4 F441 41A8       ORR              R1, R1, #(336 << 6) 
                                                            ; PLLN = 336
  172 000000F8 F441 3180       ORR              R1, R1, #(1 << 16) ; PLLP = 4
  173 000000FC F441 0180       ORR              R1, R1, #(1 << 22) 
                                                            ; PLL Source = HSE
  174 00000100 6001            STR              R1,[R0]
  175 00000102         
  176 00000102         ;PLLON
  177 00000102 4820            LDR              R0,=RCC_CR
  178 00000104 6801            LDR              R1,[R0]
  179 00000106 F041 7180       ORR              R1,R1,#(1<<24)
  180 0000010A 6001            STR              R1,[R0]
  181 0000010C         
  182 0000010C         ;PLL LOCK
  183 0000010C         pll_lock
  184 0000010C 6801            LDR              R1,[R0]
  185 0000010E F011 7F00       TST              R1,#(1<<25)
  186 00000112 D0FB            BEQ              pll_lock
  187 00000114         
  188 00000114         ;AHB,APB1/2
  189 00000114 481E            LDR              R0,=RCC_CFGR
  190 00000116 6801            LDR              R1,[R0]
  191 00000118 F021 01F0       BIC              R1, R1, #(0xF << 4) ; Clear HPR
                                                            E[7:4]  AHB



ARM Macro Assembler    Page 5 


  192 0000011C F421 51E0       BIC              R1, R1, #(0x7 << 10) ; Clear PP
                                                            RE1[12:10]
  193 00000120 F421 4160       BIC              R1, R1, #(0x7 << 13) ; Clear PP
                                                            RE2[15:13] APB2
  194 00000124 F441 5180       ORR              R1,R1,#(4<<10) ;APB1
  195 00000128 6001            STR              R1,[R0]
  196 0000012A         
  197 0000012A         ;PLL AS CLOCK SOURCE
  198 0000012A 6801            LDR              R1,[R0]
  199 0000012C F041 0102       ORR              R1,R1,#0x02
  200 00000130 6001            STR              R1,[R0]
  201 00000132         
  202 00000132         ;WAIT PLL AS CLOCK SOURCE
  203 00000132         pll_wait
  204 00000132 6801            LDR              R1,[R0]
  205 00000134 F001 010C       AND              R1, R1, #0xC ; Mask SWS
  206 00000138 2908            CMP              R1, #0x8    ; SWS = 0b10 << 2
  207 0000013A D1FA            BNE              pll_wait
  208 0000013C         
  209 0000013C         ;SYSTICK
  210 0000013C         ;Counter enable+exception disable+clock AHB
  211 0000013C 4815            LDR              R0,=STK_CTRL
  212 0000013E F04F 0105       MOV              R1,#0X05
  213 00000142 6001            STR              R1,[R0]
  214 00000144         ;load
  215 00000144 4814            LDR              R0,=STK_LOAD
  216 00000146 4915            LDR              R1,=84000-1
  217 00000148 6001            STR              R1,[R0]
  218 0000014A         ;CLEAR VAL
  219 0000014A 4815            LDR              R0,=STK_VAL
  220 0000014C F04F 0100       MOV              R1,#0
  221 00000150 6001            STR              R1,[R0]
  222 00000152         ;Counter enable+exception enable+clock AHB
  223 00000152 4810            LDR              R0,=STK_CTRL
  224 00000154 F04F 0107       MOV              R1,#0X07
  225 00000158 6001            STR              R1,[R0]
  226 0000015A         
  227 0000015A         ;PRI
  228 0000015A 4807            LDR              R0,=SCB_SHPR3
  229 0000015C F04F 61A0       MOV              R1,#(5<<24)
  230 00000160 6001            STR              R1,[R0]
  231 00000162         
  232 00000162 B662            CPSIE            I           ;ÊâìÂºÄÂÖ®Â±Ä‰∏≠Êñ≠
                                                            
  233 00000164         
  234 00000164 4770            BX               LR
  235 00000166         
  236 00000166 00 00           ALIGN
  237 00000168         
  238 00000168         
  239 00000168                 END
              00000000 
              00000000 
              00000000 
              00000000 
              E000ED20 
              00000000 
              E000ED04 
              40023800 



ARM Macro Assembler    Page 6 


              40023C00 
              40023804 
              40023808 
              E000E010 
              E000E014 
              0001481F 
              E000E018 
Command Line: --debug --xref --diag_suppress=9931 --cpu=Cortex-M4 --apcs=interw
ork --depend=.\objects\os_cpu_a.d -o.\objects\os_cpu_a.o -ID:\Keil_v5\ARM\Packs
\Keil\STM32F4xx_DFP\2.17.1\Drivers\CMSIS\Device\ST\STM32F4xx\Include --predefin
e="__UVISION_VERSION SETA 541" --predefine="STM32F401xE SETA 1" --list=.\listin
gs\os_cpu_a.lst ucos\Ports\os_cpu_a.asm



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

.text 00000000

Symbol: .text
   Definitions
      At line 16 in file ucos\Ports\os_cpu_a.asm
   Uses
      None
Comment: .text unused
OSCtxSw 00000086

Symbol: OSCtxSw
   Definitions
      At line 92 in file ucos\Ports\os_cpu_a.asm
   Uses
      At line 2 in file ucos\Ports\os_cpu_a.asm
Comment: OSCtxSw used once
OSIntCtxSw 00000092

Symbol: OSIntCtxSw
   Definitions
      At line 100 in file ucos\Ports\os_cpu_a.asm
   Uses
      At line 3 in file ucos\Ports\os_cpu_a.asm
Comment: OSIntCtxSw used once
OSStartHighRdy 0000002E

Symbol: OSStartHighRdy
   Definitions
      At line 40 in file ucos\Ports\os_cpu_a.asm
   Uses
      At line 5 in file ucos\Ports\os_cpu_a.asm
Comment: OSStartHighRdy used once
OS_CPU_SR_Restore 0000001C

Symbol: OS_CPU_SR_Restore
   Definitions
      At line 30 in file ucos\Ports\os_cpu_a.asm
   Uses
      At line 7 in file ucos\Ports\os_cpu_a.asm
Comment: OS_CPU_SR_Restore used once
OS_CPU_SR_Save 00000000

Symbol: OS_CPU_SR_Save
   Definitions
      At line 17 in file ucos\Ports\os_cpu_a.asm
   Uses
      At line 6 in file ucos\Ports\os_cpu_a.asm
Comment: OS_CPU_SR_Save used once
PendSV_Handler 0000009E

Symbol: PendSV_Handler
   Definitions
      At line 107 in file ucos\Ports\os_cpu_a.asm
   Uses
      At line 4 in file ucos\Ports\os_cpu_a.asm
Comment: PendSV_Handler used once
hse_wait 000000DA

Symbol: hse_wait



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Relocatable symbols

   Definitions
      At line 157 in file ucos\Ports\os_cpu_a.asm
   Uses
      At line 160 in file ucos\Ports\os_cpu_a.asm
Comment: hse_wait used once
mySystemInit 000000CC

Symbol: mySystemInit
   Definitions
      At line 148 in file ucos\Ports\os_cpu_a.asm
   Uses
      At line 1 in file ucos\Ports\os_cpu_a.asm
Comment: mySystemInit used once
pll_lock 0000010C

Symbol: pll_lock
   Definitions
      At line 183 in file ucos\Ports\os_cpu_a.asm
   Uses
      At line 186 in file ucos\Ports\os_cpu_a.asm
Comment: pll_lock used once
pll_wait 00000132

Symbol: pll_wait
   Definitions
      At line 203 in file ucos\Ports\os_cpu_a.asm
   Uses
      At line 207 in file ucos\Ports\os_cpu_a.asm
Comment: pll_wait used once
11 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Absolute symbols

FLASH_ACR 40023C00

Symbol: FLASH_ACR
   Definitions
      At line 140 in file ucos\Ports\os_cpu_a.asm
   Uses
      At line 163 in file ucos\Ports\os_cpu_a.asm
Comment: FLASH_ACR used once
FLASH_BASE 40023C00

Symbol: FLASH_BASE
   Definitions
      At line 136 in file ucos\Ports\os_cpu_a.asm
   Uses
      At line 140 in file ucos\Ports\os_cpu_a.asm
Comment: FLASH_BASE used once
RCC_BASE 40023800

Symbol: RCC_BASE
   Definitions
      At line 135 in file ucos\Ports\os_cpu_a.asm
   Uses
      At line 137 in file ucos\Ports\os_cpu_a.asm
      At line 138 in file ucos\Ports\os_cpu_a.asm
      At line 139 in file ucos\Ports\os_cpu_a.asm

RCC_CFGR 40023808

Symbol: RCC_CFGR
   Definitions
      At line 139 in file ucos\Ports\os_cpu_a.asm
   Uses
      At line 189 in file ucos\Ports\os_cpu_a.asm
Comment: RCC_CFGR used once
RCC_CR 40023800

Symbol: RCC_CR
   Definitions
      At line 137 in file ucos\Ports\os_cpu_a.asm
   Uses
      At line 150 in file ucos\Ports\os_cpu_a.asm
      At line 177 in file ucos\Ports\os_cpu_a.asm

RCC_PLLCFGR 40023804

Symbol: RCC_PLLCFGR
   Definitions
      At line 138 in file ucos\Ports\os_cpu_a.asm
   Uses
      At line 168 in file ucos\Ports\os_cpu_a.asm
Comment: RCC_PLLCFGR used once
SCB_ICSR E000ED04

Symbol: SCB_ICSR
   Definitions
      At line 90 in file ucos\Ports\os_cpu_a.asm
   Uses
      At line 94 in file ucos\Ports\os_cpu_a.asm
      At line 101 in file ucos\Ports\os_cpu_a.asm



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Absolute symbols


SCB_SHPR3 E000ED20

Symbol: SCB_SHPR3
   Definitions
      At line 39 in file ucos\Ports\os_cpu_a.asm
   Uses
      At line 54 in file ucos\Ports\os_cpu_a.asm
      At line 228 in file ucos\Ports\os_cpu_a.asm

STK_BASE E000E010

Symbol: STK_BASE
   Definitions
      At line 141 in file ucos\Ports\os_cpu_a.asm
   Uses
      At line 142 in file ucos\Ports\os_cpu_a.asm
      At line 143 in file ucos\Ports\os_cpu_a.asm
      At line 144 in file ucos\Ports\os_cpu_a.asm
      At line 145 in file ucos\Ports\os_cpu_a.asm

STK_CALIB E000E01C

Symbol: STK_CALIB
   Definitions
      At line 145 in file ucos\Ports\os_cpu_a.asm
   Uses
      None
Comment: STK_CALIB unused
STK_CTRL E000E010

Symbol: STK_CTRL
   Definitions
      At line 142 in file ucos\Ports\os_cpu_a.asm
   Uses
      At line 211 in file ucos\Ports\os_cpu_a.asm
      At line 223 in file ucos\Ports\os_cpu_a.asm

STK_LOAD E000E014

Symbol: STK_LOAD
   Definitions
      At line 143 in file ucos\Ports\os_cpu_a.asm
   Uses
      At line 215 in file ucos\Ports\os_cpu_a.asm
Comment: STK_LOAD used once
STK_VAL E000E018

Symbol: STK_VAL
   Definitions
      At line 144 in file ucos\Ports\os_cpu_a.asm
   Uses
      At line 219 in file ucos\Ports\os_cpu_a.asm
Comment: STK_VAL used once
13 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
External symbols

OSPrioCur 00000000

Symbol: OSPrioCur
   Definitions
      At line 11 in file ucos\Ports\os_cpu_a.asm
   Uses
      At line 48 in file ucos\Ports\os_cpu_a.asm
      At line 121 in file ucos\Ports\os_cpu_a.asm

OSPrioHighRdy 00000000

Symbol: OSPrioHighRdy
   Definitions
      At line 12 in file ucos\Ports\os_cpu_a.asm
   Uses
      At line 49 in file ucos\Ports\os_cpu_a.asm
      At line 122 in file ucos\Ports\os_cpu_a.asm

OSRunning 00000000

Symbol: OSRunning
   Definitions
      At line 13 in file ucos\Ports\os_cpu_a.asm
   Uses
      At line 60 in file ucos\Ports\os_cpu_a.asm
Comment: OSRunning used once
OSTCBCur 00000000

Symbol: OSTCBCur
   Definitions
      At line 9 in file ucos\Ports\os_cpu_a.asm
   Uses
      At line 43 in file ucos\Ports\os_cpu_a.asm
      At line 68 in file ucos\Ports\os_cpu_a.asm
      At line 112 in file ucos\Ports\os_cpu_a.asm
      At line 116 in file ucos\Ports\os_cpu_a.asm
      At line 126 in file ucos\Ports\os_cpu_a.asm

OSTCBHighRdy 00000000

Symbol: OSTCBHighRdy
   Definitions
      At line 10 in file ucos\Ports\os_cpu_a.asm
   Uses
      At line 44 in file ucos\Ports\os_cpu_a.asm
      At line 117 in file ucos\Ports\os_cpu_a.asm

5 symbols
363 symbols in table
